# 8장

스프링이란 무엇이고 어떻게 설명할 수 있을까?
스프링 프레임워크가 만들어진 이유와 존재 목적, 추구하는 가치는 무엇일까?

### 1 스프링의 정의

스프링의 정의: 자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크


#### 애플리케이션 프레임워크

일반적으로 라이브러리나 프레임워크는 특정 엽무 분야나 한 가지 기술에 특화된 목표를 가지고 만들어진다. 그래서 프레임워크는 애플리케이션의 특정 계층에서 주로 동작하는 한 가지 기술 분야에 집중된다.
하지만 스프링은 이와 다르게 '애플리케이션 프레임워크'라는 특징을 갖고 있다.

* 애플리케이션 프레임워크는 특정 계층이나, 기술, 업무 분야에 국한되지 않고 애플리케이션의 전 영역을 포괄하는 범용적인 프레임워크를 말한다. 

* 애플리케이션 개발의 전 과정을 빠르고 편리하며 효율적으로 진행하는데 일차적인 목표를 두는 프레임 워크다.

* 애플리케이션의 전 영역을 관통하는 일관된 프로그래밍 모델과 핵심 기술을 바탕으로 각 분야의 특성에 맞는 필요를 채워주고 있기 때문에 애플리케이션을 빠르고 효과적으로 개발할 수 있다.
=> 스프링이 애플리케이션 프레임워크라고 불리는 이유

#### 경량급

* 스프링이 경량급이라는 건 스프링 자체가 아주 가볍다거나 작은 규모의 코드로 이뤄졌다는 뜻이 아니라 불필요하게 무겁지 않다는 의미이다.
* 가볍고 단순한 환경에서도 엔터프라이즈 개발의 고급 기술을 대부분 사용할 수 있다.
* 생산성과 품질 면에서 유리하다. 

#### 자바 엔터프라이즈 개발을 편하게

스프링은 **근본적인 부분**에서 엔터프라이즈 개발의 복잡함을 제거해내고 진정으로 개발을 편하게 해주는 해결책을 제시한다.

* 편리한 애플리케이션 개발이란 개발자가 복잡하고 실수하기 쉬운 로우레벨 기술에 많은 신경을 쓰지 않으면서도 애플리케이션의 핵심인 사용자의 요구사항, 즉 비즈니스 로직을 빠르고 효과적으로 구현하는 것

* 엔터프라이즈 개발에서 필연적으로 요구되는 기술적인 요구를 충족하면서도 개발을 복잡하게 만들지 않는다.

#### 오픈소스

오픈소스란 소스가 모두에게 공개되고, 특별한 라이선스를 취득할 필요없이 얼마든지 가져다 자유롭게 이용해도 된다는 뜻이다. 

* 스프링에 적용된 오픈소스 라이선스는 아파치 라이선스 버전 2.0 => 비교적 제약이 적어 사용이 매우 자유로운 편임
* 개발 과정에 많은 사람이 자유롭게 참여
* 오픈소스의 장점은 공개된 커뮤니티의 공간 안에서 투명한 방식으로 다양한 참여를 통해 개발되기 때문에 매우 빠르고 유연한 개발이 가능
* 지속적이고 안정적인 개발이 계속될지가 불확실하다는 단점

### 2. 스프링의 목적

스프링의 목적: 경량급 프레임워크인 스프링을 활용해서 엔터프라이즈 애플리케이션 개발을 편하게 하는 것

굳이 스프링을 사용하는 이유? 엔터프라이즈 개발이란 편하지않기 때문이다.

#### 엔터프라이즈 개발의 복잡함

왜 엔터프라이즈 시스템 개발은 복잡할까? 크게 두가지 원인이 있다.

* 기술적인 제약조건과 요구사항이 늘어가기 때문이다.
  * 엔터프라이즈 시스템을 개발하는 데는 순수한 비즈니스 로직을 구현하는 것 외에도 기술적으로 고려할 사항이 많다.
* 엔터프라이즈 애플리케이션이 구현해야 할 핵심기능인 비즈니스 로직의 복잡합이 증가하기 때문이다.


엔터프라이즈 애플리케이션 개발이 실패하는 주요 원인은 비즈니스 로직의 복잡함과 기술적인 복잡함이다. 이 두 가지 복잡함이
한데 얽혀 있기 때문에 복잡함이 몇배로 가중되는 것이다.

#### 복잡함을 해결하려는 도전

* 제거될 수 없는 근본적인 복잡함 => 제거 대상이 아니므로 효과적으로 상대할 수 있는 전략과 기법이 필요하다. 
  * 비즈니스 로직의 복잡함과 기술적인 복잡함을 효과적으로 처리하는데 적용되는 방법이 다르기 때문에 먼저 성격이 다른 이 두 가지 복잡함을 분리해내야 한다. 
* 실패한 해결책:EJB 
  * 기본 전략=> 두 가지 종류의 복잡함을 분리하는 것
  * 애플리케이션 로직을 담은 핵심 코드에서 일부 기술적인 코드가 제거된 건 사실이지만, 오히려 EJB라는 환경과 스펙에 종속되는 코드로 만들어져야 하는 부담을 안게 된다.
* 비침투적인 방식을 통한 효과적인 해결책: 스프링
  * 어떤 기술을 적용했을 때 그 기술과 관련된 코드나 규약등이 코드에 등장하는 경우를 침투적인 기술이라고 한다. 
  * 꼭 필요한 기능을 사용하는 것도 아니면서 코드에 마구 등장하면 침투적인 기술이 되며 복잡함을 가중시키는 원인이 된다.
  * 비침투적인 기술은 기술의 적용 사실이 코드에 직접 반영되지 않는다는 특징이 있다.
  * 스프링이 성공할 수 있었던 비결은 비침투적인 기술이라는 전략을 택했기 때문이다. => 기술적인 복잡함과 비즈니스 로직을 다루는 코드를 분리할 수 있다. 


#### 복잡함을 상대하는 스프링의 전략

기본 전략: 분리!

##### 기술적 복잡함을 상대하는 전략

스프링은 엔터프라이즈 기술을 적용했을 때 발생하는 복잡함의 문제를 두 가지로 분류하고 각각에 대한 적절한 대응 방법을 제공한다.

* 첫 번째 문제: 기술에 대한 접근 방식이 일관성이 없고, 특정 환경에 종속적이다.
  * 일관성 없는 기술과 서버환경의 변화에 대한 스프링의 공략법은 서비스 추상화다.
  * 기술적인 복잡함은 일단 추상화를 통해 로우레벨의 기술 구현 부분과 기술을 사용하는 인터페이스를 분리하고,
  환경과 세부 기술에 독립적인 접근 인터페이스를 제공하는 것이 가장 좋은 해결책이다. 
  
* 두 번째 문제: 비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략
  *  AOP는 기술을 다루는 코드로 인한 복잡함이 기술 그 자체 이상으로 불필요하게 증대되지 않도록 도와주는 가장 강력한 수단이다. 


##### 비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략

* 비즈니스 로직을 다루는 핵심 코드에 오류가 있으면 엔터프라이즈 시스템을 사용하는 업무 자체에 큰 지장을 주거나 치명적인 손실을 끼칠 수도 있다.
* 예전에는 DB에서 비즈니스 로직을 처리했지만, DB에 부담을 주는 것도 문제고, 데이터 액세르를 중심으로 로직을 다루면 개발과 유지보수는 물론이고, 테스트도 매우 어렵다
* 엔터프라이즈 시스템 개발의 흐름은 점차로 비즈니스 로직은 애플리케이션 안에서 처리하는 추세이다.


##### 핵심도구: 객체지향과 DI

기술과 비즈니스 로직의 복잡함을 해결하는데 스프링이 공통적으로 사용하는 도구가 바로 객체지향이다. 
객체지향의 설계 기법을 잘 적용할 수 있는 구조를 만들기 위해 DI 같은 기술을 편리하게 적용하도록 스프링이 도와준다. 
결국 모든 스프링의 기술과 전력은 객체지향이라는 자바 언어가 가진 강력한 도구를 극대화해서 사용할 수 있도록 돕는 것이다. 

## 3. POJO 프로그래밍

스프링의 목적은 애플리케이션 개발의 복잡함을 줄여주는 것 또는 효과적으로 대응하게 해주는 것이라고 하면 추상적이다. 

스프링의 정수는 엔터프라이즈 서비스 기능을 POJO에 제공하는 것이라고 한다.

* 엔터프라이즈 서비스라고 하는 것은 보안, 트랜잭션과 같은 엔터프라이즈 시스템에서 요구되는 기술을 말한다. 

즉, 스프링의 가장 강력한 특징과 목표는 분리됐지만 반드시 필요한 엔터프라이즈 서비스 기술을 POJO 방식으로 개발된 애플리케이션 핵심 로직을 담은 코드에 제공한다. 

#### 스프링의 핵심: POJO

![image](https://user-images.githubusercontent.com/48270067/154457435-8022d30f-2126-4282-afc0-1fc79d9dcb31.png)


스프링 애플리케이션: POJO를 이용해서 만든 애플리케이션 코드 + POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계 정보.
스프링의 주요 기술: IOC/DI, AOP, PSA => 애플리케이션을 POJO로 개발할 수 있게 해주는 기능기술이라고 불린다.


#### POJO란 ??

Plain Old Java Object.

마틴 파울러가 만들어낸 용어이다. 
평범한 자바오브젝트에는 EJB와 같은 그럴싸한 이름이 없기 때문에 있어보이도록 만든 이름이다.

#### POJO의 조건

다음의 세 가지 조건을 충족해야 POJO라고 불릴 수 있다. 

1. 특정 규약에 종속되지 않는다.
  * 자바 언어와 꼭 필요한 API외에는 종속되지 않아야 한다. 
2. 특정 환경에 종속되지 않는다.
  * 비즈니스 로직을 담고있는 POJO클래스는 웹이라는 환경 정보나 웹 기술을 담고 있는 클래스/인터페이스를 사용해서는 안된다.
    * 나중에 웹 컨트롤러와 연결돼서 사용할게 뻔하다고 해도 직접적으로 웹이라는 환경으로 제한해버리는 오브젝트나 API에 의존하면 웹 외의 클라이언트가 못쓰고, 독립적으로 테스트하기도 어려워짐.
3. 객체지향적 자바언어의 기본에 충실해야한다. 


#### POJO의 장점

* 특정한 기술과 환경에 종속되지 않는 오브젝트는 그만큼 깔끔한 코드가 될 수 있다.
* 자동화된 테스트에 매우 유리
* 객체지향적인 설계를 자유롭게 적용 가능

#### POJO 프레임워크

POJO 프로그래밍이 가능하도록 기술적인 기반을 제공하는 프레임워크를 POJO 프레임워크라고 한다. 
스프링을 이용하면 POJO 프로그래밍의 장점을 그대로 살려서 엔터프라이즈 애플리케이션의 핵심 로직을 객체지향적인 POJO를 기반으로 깔끔하게 구현 가능


## 4. 스프링의 기술

#### 제어의 역전(IoC) / 의존관계 주입(DI)

장점 : 유연한 확장이 가능하게 하기 위해 -> DI는 OCP(개방 폐쇄 원칙)으로 잘 설명될 수 있다. DI는 OCP의 '변경에는 닫혀있다.'라는 말로도 설명가능하다. 

* DI 활용 방법
  1. 핵심기능의 변경(의존 대상의 구현을 바꾸는 것)
  2. 핵심기능의 동적인 변경(ex. 사용자의 등급에 따라 알맞는 datasource 제공)
  3. 부가기능의 추가(ex. 트랜잭션 기능을 부여한 것)
  4. 인터페이스의 변경(ex. a -> c 사용하고 싶지만 b 인터페이스를 사용하고 있을 때 b 인터페이스에 어댑터로 c를 DI)
  5. 프록시(ex. lazy loading)
  6. 템플릿과 콜백
  7. 싱글톤과 오브젝트 스코프
  8. 테스트(테스트 대상인 오브젝트의 기능에 충실하게 테스트가 가능)

#### 애스펙트 지향 프로그래밍(AOP) 

보통 IoC/DI 기법으로 POJO프로그래밍을 하지만, 일부 서비스는 순수한 객체지향기법만으로는 POJO의 조건을 유지한 채로 적용하기 힘들다. => 이런걸 해결하기 위해 AOP가 필요하다.

AOP의 적용 기법은 크게 두 가지로 분류할 수 있다. 

1. 스프링처럼 다이내믹 프록시 사용하기
  * 이 방법은 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용한 것이다.  
  * 만들기 쉽고 적용 간편하지만, 부가기능을 부여할 수 있는 곳은 메서드 호출이 일어나는 지점으로 한정됨.
2. 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법
  * AspectJ 사용하여 메서드 호출 뿐만아니라 인스턴스 생성, 필드 액세스, 특정 호출 경로를 가진 메서드 호출 등에도 부가기능 제공 가능.
  * 별도의 AOP컴파일러를 이용한 빌드과정을 거치거나, 클래스가 메모리로 로딩될때 바이트코드를 조작해서 이루어진다. 사용하기 까다롭지만 경우에 따라서는 이걸 써야하기도.


#### 포터블 서비스 추상화(PSA)

환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근 할 수 있게 해주는 것을 PSA라고 한다. 

